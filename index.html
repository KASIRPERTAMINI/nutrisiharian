<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriTrack - Pelacak Kalori & Protein</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .animate-slideUp { animation: slideUp 0.3s ease-out; }
        .animate-fadeIn { animation: fadeIn 0.2s ease-out; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // ====================================
        // GANTI API KEY DI BAWAH INI
        // ====================================
        const GEMINI_API_KEY = "AIzaSyC8DtR-BgURqFDuK0C7gNSusUZi24jy0ZU"; // Ganti dengan API key dari Google AI Studio
        // ====================================
        
        const CalorieTrackerApp = () => {
            const [dailyCalories, setDailyCalories] = useState(0);
            const [dailyProtein, setDailyProtein] = useState(0);
            const [targetCalories, setTargetCalories] = useState(2500);
            const [targetProtein, setTargetProtein] = useState(120);
            const [foodLog, setFoodLog] = useState([]);
            const [showModal, setShowModal] = useState(null);
            const [showConfirmDialog, setShowConfirmDialog] = useState(null);
            const [userName, setUserName] = useState('User');
            const [isAnalyzing, setIsAnalyzing] = useState(false);
            const [capturedImage, setCapturedImage] = useState(null);
            const [foodDescription, setFoodDescription] = useState('');
            const [analysisResult, setAnalysisResult] = useState(null);
            const [manualFood, setManualFood] = useState({ name: '', calories: '', protein: '', mealTime: 'Pagi' });
            const [editingTarget, setEditingTarget] = useState({ calories: '', protein: '' });
            const fileInputRef = useRef(null);
            const cameraInputRef = useRef(null);

            useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                const today = new Date().toDateString();
                const todayLog = foodLog.filter(item => new Date(item.timestamp).toDateString() === today);
                
                const totalCal = todayLog.reduce((sum, item) => sum + item.calories, 0);
                const totalProt = todayLog.reduce((sum, item) => sum + item.protein, 0);
                
                setDailyCalories(totalCal);
                setDailyProtein(totalProt);
                
                localStorage.setItem('foodLog', JSON.stringify(foodLog));
            }, [foodLog]);

            const loadData = () => {
                const savedTargets = localStorage.getItem('nutritionTargets');
                if (savedTargets) {
                    const targets = JSON.parse(savedTargets);
                    setTargetCalories(targets.calories);
                    setTargetProtein(targets.protein);
                }

                const savedProfile = localStorage.getItem('userProfile');
                if (savedProfile) {
                    const profile = JSON.parse(savedProfile);
                    setUserName(profile.name);
                }

                const savedLog = localStorage.getItem('foodLog');
                if (savedLog) {
                    setFoodLog(JSON.parse(savedLog));
                }
            };

            const handleImageCapture = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => {
                        setCapturedImage(reader.result);
                        setShowModal('description');
                    };
                    reader.readAsDataURL(file);
                }
            };

            const analyzeFood = async () => {
                if (!capturedImage) return;
                
                if (GEMINI_API_KEY === "GANTI_DENGAN_API_KEY_ANDA") {
                    alert("âš ï¸ Harap ganti API_KEY di file HTML terlebih dahulu!\n\nDapatkan gratis di: https://aistudio.google.com/app/apikey");
                    return;
                }

                setIsAnalyzing(true);
                setShowModal('analyzing');
                setAnalysisResult(null);

                try {
                    const base64Data = capturedImage.split(',')[1];
                    
                    const prompt = foodDescription 
                        ? `Kamu adalah ahli gizi profesional. Analisis gambar makanan ini. Deskripsi user: "${foodDescription}". 

Identifikasi semua makanan yang terlihat dan berikan estimasi kalori dan protein yang realistis berdasarkan porsi standar.

PENTING: Berikan response HANYA dalam format JSON yang valid, tanpa text lain:
{
  "items": [
    {
      "name": "Nama makanan dalam Bahasa Indonesia",
      "portion": "deskripsi porsi",
      "calories": angka_kalori,
      "protein": angka_protein
    }
  ],
  "total": {
    "calories": total_kalori,
    "protein": total_protein
  }
}`
                        : `Kamu adalah ahli gizi profesional. Analisis gambar makanan ini dan identifikasi semua makanan yang terlihat.

Berikan estimasi kalori dan protein yang realistis berdasarkan porsi standar yang terlihat.

PENTING: Berikan response HANYA dalam format JSON yang valid, tanpa text lain:
{
  "items": [
    {
      "name": "Nama makanan dalam Bahasa Indonesia",
      "portion": "deskripsi porsi",
      "calories": angka_kalori,
      "protein": angka_protein
    }
  ],
  "total": {
    "calories": total_kalori,
    "protein": total_protein
  }
}`;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: prompt },
                                    {
                                        inline_data: {
                                            mime_type: "image/jpeg",
                                            data: base64Data
                                        }
                                    }
                                ]
                            }]
                        })
                    });

                    const data = await response.json();
                    
                    if (data.error) {
                        throw new Error(data.error.message);
                    }

                    const text = data.candidates[0].content.parts[0].text;
                    const jsonMatch = text.match(/\{[\s\S]*\}/);
                    
                    if (jsonMatch) {
                        const result = JSON.parse(jsonMatch[0]);
                        setAnalysisResult(result);
                        setShowModal('result');
                    } else {
                        throw new Error('Invalid response format');
                    }
                } catch (error) {
                    console.error('Error analyzing food:', error);
                    alert('Gagal menganalisis gambar: ' + error.message);
                    setShowModal('error');
                } finally {
                    setIsAnalyzing(false);
                }
            };

            const addAnalyzedFood = () => {
                if (!analysisResult) return;

                const newEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    mealTime: getMealTime(),
                    items: analysisResult.items,
                    calories: analysisResult.total.calories,
                    protein: analysisResult.total.protein,
                    image: capturedImage
                };

                setFoodLog([...foodLog, newEntry]);
                setCapturedImage(null);
                setFoodDescription('');
                setAnalysisResult(null);
                setShowModal('success');
                
                setTimeout(() => {
                    setShowModal(null);
                }, 1500);
            };

            const getMealTime = () => {
                const hour = new Date().getHours();
                if (hour < 11) return 'Pagi';
                if (hour < 15) return 'Siang';
                if (hour < 19) return 'Malam';
                return 'Camilan';
            };

            const addManualFood = () => {
                if (!manualFood.name || !manualFood.calories || !manualFood.protein) return;

                const calories = parseInt(manualFood.calories);
                const protein = parseInt(manualFood.protein);

                const newEntry = {
                    id: Date.now(),
                    timestamp: new Date().toISOString(),
                    mealTime: manualFood.mealTime,
                    items: [{ 
                        name: manualFood.name, 
                        portion: 'Manual entry',
                        calories: calories, 
                        protein: protein 
                    }],
                    calories: calories,
                    protein: protein
                };

                setFoodLog([...foodLog, newEntry]);
                setManualFood({ name: '', calories: '', protein: '', mealTime: 'Pagi' });
                setShowModal('success');
                
                setTimeout(() => {
                    setShowModal(null);
                }, 1500);
            };

            const deleteEntry = (id) => {
                setFoodLog(foodLog.filter(item => item.id !== id));
                setShowConfirmDialog(null);
            };

            const resetAllData = () => {
                setFoodLog([]);
                setShowConfirmDialog(null);
            };

            const updateTargets = () => {
                const calories = parseInt(editingTarget.calories) || 2500;
                const protein = parseInt(editingTarget.protein) || 120;
                
                setTargetCalories(calories);
                setTargetProtein(protein);
                localStorage.setItem('nutritionTargets', JSON.stringify({ calories, protein }));
                setShowModal(null);
            };

            const updateProfile = () => {
                localStorage.setItem('userProfile', JSON.stringify({ name: userName }));
                setShowModal(null);
            };

            const handleNumberInput = (value, setter, field) => {
                const cleaned = value.replace(/\D/g, '');
                const withoutLeadingZeros = cleaned.replace(/^0+/, '') || '';
                
                if (field) {
                    setter(prev => ({ ...prev, [field]: withoutLeadingZeros }));
                } else {
                    setter(withoutLeadingZeros);
                }
            };

            const ProgressCircle = ({ value, max, label, color }) => {
                const percentage = Math.min((value / max) * 100, 100);
                const circumference = 2 * Math.PI * 45;
                const strokeDashoffset = circumference - (percentage / 100) * circumference;

                return (
                    <div className="flex flex-col items-center w-full">
                        <div className="relative w-36 h-36">
                            <svg className="transform -rotate-90 w-36 h-36">
                                <circle cx="72" cy="72" r="45" stroke="#2a2a2a" strokeWidth="10" fill="none" />
                                <circle 
                                    cx="72" 
                                    cy="72" 
                                    r="45" 
                                    stroke={color} 
                                    strokeWidth="10" 
                                    fill="none"
                                    strokeDasharray={circumference}
                                    strokeDashoffset={strokeDashoffset}
                                    style={{transition: 'all 1s ease-out'}}
                                    strokeLinecap="round"
                                />
                            </svg>
                            <div className="absolute inset-0 flex flex-col items-center justify-center">
                                <span className="text-2xl font-bold text-white">{Math.round(value)}</span>
                                <span className="text-xs text-gray-400">/ {max}</span>
                            </div>
                        </div>
                        <span className="mt-2 text-sm font-medium text-gray-300">{label}</span>
                    </div>
                );
            };

            const CustomDialog = ({ isOpen, onClose, onConfirm, title, message, type = 'danger' }) => {
                if (!isOpen) return null;

                return (
                    <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                        <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-5 max-w-sm w-full border border-gray-700 shadow-2xl animate-fadeIn">
                            <h3 className="text-lg font-bold text-white mb-2">{title}</h3>
                            <p className="text-gray-300 text-sm mb-5">{message}</p>
                            <div className="flex gap-2">
                                <button
                                    onClick={onClose}
                                    className="flex-1 py-2.5 rounded-xl bg-gray-700 text-white hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                >
                                    Batal
                                </button>
                                <button
                                    onClick={onConfirm}
                                    className={`flex-1 py-2.5 rounded-xl text-white transition-all duration-200 font-medium text-sm ${
                                        type === 'danger' 
                                            ? 'bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800' 
                                            : 'bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-700 hover:to-emerald-800'
                                    }`}
                                >
                                    {type === 'danger' ? 'Hapus' : 'Konfirmasi'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };

            const todayLog = foodLog.filter(item => new Date(item.timestamp).toDateString() === new Date().toDateString());

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white pb-20">
                    <div className="bg-gradient-to-r from-gray-800 to-gray-900 border-b border-gray-700 px-4 py-3 shadow-lg sticky top-0 z-30">
                        <div className="max-w-2xl mx-auto flex justify-between items-center">
                            <h1 className="text-xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent">
                                NutriTrack
                            </h1>
                            <button
                                onClick={() => setShowModal('profile')}
                                className="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-gray-700 transition-all duration-200"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                            </button>
                        </div>
                    </div>

                    <div className="max-w-2xl mx-auto px-4 py-4 space-y-4">
                        <div className="bg-gradient-to-br from-emerald-600 to-cyan-600 rounded-2xl p-5 shadow-xl">
                            <h2 className="text-2xl font-bold">Halo, {userName}! ðŸ‘‹</h2>
                            <p className="text-sm opacity-90 mt-1">Mari lacak nutrisi harian Anda</p>
                        </div>

                        <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-5 border border-gray-700 shadow-xl">
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="text-lg font-bold text-white">Target Harian</h3>
                                <button
                                    onClick={() => {
                                        setEditingTarget({ calories: targetCalories.toString(), protein: targetProtein.toString() });
                                        setShowModal('settings');
                                    }}
                                    className="text-emerald-400 hover:text-emerald-300 transition-colors"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                </button>
                            </div>
                            <div className="flex justify-around items-center gap-4">
                                <ProgressCircle 
                                    value={dailyCalories} 
                                    max={targetCalories} 
                                    label="Kalori (kkal)" 
                                    color="#10b981"
                                />
                                <ProgressCircle 
                                    value={dailyProtein} 
                                    max={targetProtein} 
                                    label="Protein (g)" 
                                    color="#06b6d4"
                                />
                            </div>
                        </div>

                        <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-5 border border-gray-700 shadow-xl">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-lg font-bold text-white">Log Hari Ini</h3>
                                {todayLog.length > 0 && (
                                    <button
                                        onClick={() => setShowConfirmDialog('resetAll')}
                                        className="text-red-400 hover:text-red-300 transition-colors flex items-center gap-1.5 text-sm"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                        Reset
                                    </button>
                                )}
                            </div>
                            
                            {todayLog.length === 0 ? (
                                <div className="text-center py-10 text-gray-400">
                                    <p className="text-base mb-1">Belum ada makanan tercatat</p>
                                    <p className="text-sm">Tap tombol + untuk mulai</p>
                                </div>
                            ) : (
                                <div className="space-y-2.5">
                                    {todayLog.map(entry => (
                                        <div key={entry.id} className="bg-gray-700 bg-opacity-50 rounded-xl p-3.5 hover:bg-opacity-70 transition-all duration-200 border border-gray-600">
                                            <div className="flex justify-between items-start gap-3">
                                                <div className="flex-1 min-w-0">
                                                    <div className="flex items-center gap-2 mb-2 flex-wrap">
                                                        <span className="px-2.5 py-0.5 rounded-lg bg-gradient-to-r from-emerald-600 to-cyan-600 text-xs font-semibold whitespace-nowrap">
                                                            {entry.mealTime}
                                                        </span>
                                                        <span className="text-xs text-gray-400">
                                                            {new Date(entry.timestamp).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}
                                                        </span>
                                                    </div>
                                                    {entry.items.map((item, idx) => (
                                                        <div key={idx} className="mb-1">
                                                            <p className="text-white font-medium text-sm">{item.name}</p>
                                                            {item.portion && item.portion !== 'Manual entry' && (
                                                                <p className="text-xs text-gray-400">{item.portion}</p>
                                                            )}
                                                        </div>
                                                    ))}
                                                    <div className="flex gap-3 mt-2 text-sm">
                                                        <span className="text-emerald-400 font-semibold">{entry.calories} kkal</span>
                                                        <span className="text-cyan-400 font-semibold">{entry.protein}g protein</span>
                                                    </div>
                                                </div>
                                                <button
                                                    onClick={() => setShowConfirmDialog(entry.id)}
                                                    className="text-red-400 hover:text-red-300 transition-colors p-1.5 flex-shrink-0"
                                                >
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>

                    <button
                        onClick={() => setShowModal('addFood')}
                        className="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-gradient-to-r from-emerald-600 to-cyan-600 shadow-2xl flex items-center justify-center hover:scale-110 transition-transform duration-200 z-40"
                        style={{transform: 'scale(1)'}}
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    </button>

                    {/* Modals */}
                    {showModal === 'addFood' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-t-3xl sm:rounded-2xl p-5 w-full sm:max-w-md border-t sm:border border-gray-700 shadow-2xl animate-slideUp">
                                <div className="flex justify-between items-center mb-5">
                                    <h3 className="text-lg font-bold text-white">Tambah Makanan</h3>
                                    <button onClick={() => setShowModal(null)} className="text-gray-400 hover:text-white transition-colors p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                    </button>
                                </div>
                                <div className="space-y-2.5">
                                    <button
                                        onClick={() => cameraInputRef.current.click()}
                                        className="w-full py-3.5 rounded-xl bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 transition-all duration-200 font-medium flex items-center justify-center gap-2.5 shadow-lg text-sm"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                                        Input Manual
                                    </button>
                                </div>
                                <input
                                    ref={cameraInputRef}
                                    type="file"
                                    accept="image/*"
                                    capture="environment"
                                    onChange={handleImageCapture}
                                    style={{display: 'none'}}
                                />
                                <input
                                    ref={fileInputRef}
                                    type="file"
                                    accept="image/*"
                                    onChange={handleImageCapture}
                                    style={{display: 'none'}}
                                />
                            </div>
                        </div>
                    )}

                    {showModal === 'description' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-t-3xl sm:rounded-2xl p-5 w-full sm:max-w-md border-t sm:border border-gray-700 shadow-2xl animate-slideUp my-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white">Deskripsi Makanan</h3>
                                    <button onClick={() => {
                                        setShowModal(null);
                                        setCapturedImage(null);
                                        setFoodDescription('');
                                    }} className="text-gray-400 hover:text-white transition-colors p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                    </button>
                                </div>
                                
                                {capturedImage && (
                                    <img src={capturedImage} alt="Food" className="w-full rounded-xl mb-4 border border-gray-600" style={{maxHeight: '16rem', objectFit: 'cover'}} />
                                )}
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-medium text-gray-300 mb-2">
                                        Tambah keterangan (opsional)
                                    </label>
                                    <textarea
                                        value={foodDescription}
                                        onChange={(e) => setFoodDescription(e.target.value)}
                                        placeholder="Contoh: Nasi goreng dengan telur dan ayam..."
                                        className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm resize-none"
                                        rows="3"
                                    />
                                </div>
                                
                                <div className="flex gap-2.5">
                                    <button
                                        onClick={() => {
                                            setShowModal(null);
                                            setCapturedImage(null);
                                            setFoodDescription('');
                                        }}
                                        className="flex-1 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                    >
                                        Batal
                                    </button>
                                    <button
                                        onClick={analyzeFood}
                                        className="flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 transition-all duration-200 font-medium text-sm"
                                    >
                                        Analisis
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal === 'analyzing' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 max-w-sm w-full border border-gray-700 shadow-2xl text-center">
                                <div className="flex justify-center mb-4">
                                    <div className="w-16 h-16 border-4 border-emerald-500 border-t-transparent rounded-full" style={{animation: 'spin 1s linear infinite'}}></div>
                                </div>
                                <h3 className="text-lg font-bold text-white mb-2">Menganalisis Makanan...</h3>
                                <p className="text-gray-400 text-sm">AI sedang mendeteksi nutrisi dari foto Anda</p>
                            </div>
                        </div>
                    )}

                    {showModal === 'result' && analysisResult && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-t-3xl sm:rounded-2xl p-5 w-full sm:max-w-md border-t sm:border border-gray-700 shadow-2xl animate-slideUp my-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white">Hasil Deteksi</h3>
                                    <button onClick={() => {
                                        setShowModal(null);
                                        setCapturedImage(null);
                                        setFoodDescription('');
                                        setAnalysisResult(null);
                                    }} className="text-gray-400 hover:text-white transition-colors p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                    </button>
                                </div>
                                
                                {capturedImage && (
                                    <img src={capturedImage} alt="Food" className="w-full rounded-xl mb-4 border border-gray-600" style={{maxHeight: '12rem', objectFit: 'cover'}} />
                                )}
                                
                                <div className="bg-gray-700 bg-opacity-50 rounded-xl p-4 border border-gray-600 mb-4">
                                    <h4 className="text-sm font-semibold text-emerald-400 mb-3">Makanan Terdeteksi:</h4>
                                    <div className="space-y-2.5">
                                        {analysisResult.items.map((item, idx) => (
                                            <div key={idx} className="bg-gray-800 bg-opacity-50 rounded-lg p-3">
                                                <p className="text-white font-medium text-sm mb-1">{item.name}</p>
                                                {item.portion && (
                                                    <p className="text-xs text-gray-400 mb-2">{item.portion}</p>
                                                )}
                                                <div className="flex gap-3 text-xs">
                                                    <span className="text-emerald-400 font-semibold">{item.calories} kkal</span>
                                                    <span className="text-cyan-400 font-semibold">{item.protein}g protein</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    <div className="mt-4 pt-4 border-t border-gray-600">
                                        <p className="text-sm font-semibold text-white mb-2">Total Estimasi:</p>
                                        <div className="flex justify-between items-center bg-gradient-to-r from-emerald-600 to-cyan-600 rounded-lg p-3">
                                            <div className="text-center flex-1">
                                                <p className="text-xs text-white opacity-80 mb-1">Kalori</p>
                                                <p className="text-xl font-bold text-white">{analysisResult.total.calories}</p>
                                                <p className="text-xs text-white opacity-80">kkal</p>
                                            </div>
                                            <div className="w-px h-12 bg-white opacity-30"></div>
                                            <div className="text-center flex-1">
                                                <p className="text-xs text-white opacity-80 mb-1">Protein</p>
                                                <p className="text-xl font-bold text-white">{analysisResult.total.protein}</p>
                                                <p className="text-xs text-white opacity-80">gram</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex gap-2.5">
                                    <button
                                        onClick={() => {
                                            setShowModal(null);
                                            setCapturedImage(null);
                                            setFoodDescription('');
                                            setAnalysisResult(null);
                                        }}
                                        className="flex-1 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                    >
                                        Batal
                                    </button>
                                    <button
                                        onClick={addAnalyzedFood}
                                        className="flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 transition-all duration-200 font-medium text-sm"
                                    >
                                        Tambahkan ke Log
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal === 'success' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 max-w-sm w-full border border-gray-700 shadow-2xl text-center animate-fadeIn">
                                <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-r from-emerald-600 to-cyan-600 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                </div>
                                <h3 className="text-lg font-bold text-white mb-2">Berhasil Ditambahkan!</h3>
                                <p className="text-gray-400 text-sm">Makanan telah dicatat ke log harian Anda</p>
                            </div>
                        </div>
                    )}

                    {showModal === 'error' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 max-w-sm w-full border border-gray-700 shadow-2xl text-center">
                                <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-red-600 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                </div>
                                <h3 className="text-lg font-bold text-white mb-2">Gagal Menganalisis</h3>
                                <p className="text-gray-400 text-sm mb-5">Terjadi kesalahan saat menganalisis gambar. Silakan coba lagi.</p>
                                <button
                                    onClick={() => {
                                        setShowModal(null);
                                        setCapturedImage(null);
                                        setFoodDescription('');
                                        setAnalysisResult(null);
                                    }}
                                    className="w-full py-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                >
                                    Tutup
                                </button>
                            </div>
                        </div>
                    )}

                    {showModal === 'manual' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4 overflow-y-auto">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-t-3xl sm:rounded-2xl p-5 w-full sm:max-w-md border-t sm:border border-gray-700 shadow-2xl animate-slideUp my-auto">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white">Input Manual</h3>
                                    <button onClick={() => setShowModal(null)} className="text-gray-400 hover:text-white transition-colors p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                    </button>
                                </div>
                                <div className="space-y-3.5">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Nama Makanan</label>
                                        <input
                                            type="text"
                                            value={manualFood.name}
                                            onChange={(e) => setManualFood({...manualFood, name: e.target.value})}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                            placeholder="Contoh: Nasi Goreng"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Kalori (kkal)</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={manualFood.calories}
                                            onChange={(e) => handleNumberInput(e.target.value, setManualFood, 'calories')}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                            placeholder="Contoh: 500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Protein (g)</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={manualFood.protein}
                                            onChange={(e) => handleNumberInput(e.target.value, setManualFood, 'protein')}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                            placeholder="Contoh: 25"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Waktu Makan</label>
                                        <select
                                            value={manualFood.mealTime}
                                            onChange={(e) => setManualFood({...manualFood, mealTime: e.target.value})}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                        >
                                            <option value="Pagi">Pagi</option>
                                            <option value="Siang">Siang</option>
                                            <option value="Malam">Malam</option>
                                            <option value="Camilan">Camilan</option>
                                        </select>
                                    </div>
                                </div>
                                <div className="flex gap-2.5 mt-5">
                                    <button
                                        onClick={() => setShowModal(null)}
                                        className="flex-1 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                    >
                                        Batal
                                    </button>
                                    <button
                                        onClick={addManualFood}
                                        disabled={!manualFood.name || !manualFood.calories || !manualFood.protein}
                                        className="flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 transition-all duration-200 font-medium text-sm disabled:opacity-50 disabled:cursor-not-allowed"
                                    >
                                        Tambahkan
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal === 'settings' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-t-3xl sm:rounded-2xl p-5 w-full sm:max-w-md border-t sm:border border-gray-700 shadow-2xl animate-slideUp">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white">Atur Target Harian</h3>
                                    <button onClick={() => setShowModal(null)} className="text-gray-400 hover:text-white transition-colors p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                    </button>
                                </div>
                                <div className="space-y-3.5">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Target Kalori (kkal)</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={editingTarget.calories}
                                            onChange={(e) => handleNumberInput(e.target.value, setEditingTarget, 'calories')}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                            placeholder="Contoh: 2500"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Target Protein (g)</label>
                                        <input
                                            type="text"
                                            inputMode="numeric"
                                            value={editingTarget.protein}
                                            onChange={(e) => handleNumberInput(e.target.value, setEditingTarget, 'protein')}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                            placeholder="Contoh: 120"
                                        />
                                    </div>
                                </div>
                                <div className="flex gap-2.5 mt-5">
                                    <button
                                        onClick={() => setShowModal(null)}
                                        className="flex-1 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                    >
                                        Batal
                                    </button>
                                    <button
                                        onClick={updateTargets}
                                        className="flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 transition-all duration-200 font-medium text-sm"
                                    >
                                        Simpan
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {showModal === 'profile' && (
                        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-end sm:items-center justify-center z-50 p-0 sm:p-4">
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-t-3xl sm:rounded-2xl p-5 w-full sm:max-w-md border-t sm:border border-gray-700 shadow-2xl animate-slideUp">
                                <div className="flex justify-between items-center mb-4">
                                    <h3 className="text-lg font-bold text-white">Profil</h3>
                                    <button onClick={() => setShowModal(null)} className="text-gray-400 hover:text-white transition-colors p-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                    </button>
                                </div>
                                <div className="flex flex-col items-center mb-5">
                                    <div className="w-20 h-20 rounded-full bg-gradient-to-r from-emerald-600 to-cyan-600 flex items-center justify-center mb-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                    </div>
                                </div>
                                <div className="space-y-3.5">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-300 mb-2">Nama</label>
                                        <input
                                            type="text"
                                            value={userName}
                                            onChange={(e) => setUserName(e.target.value)}
                                            className="w-full px-4 py-3 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder-gray-400 focus:outline-none focus:border-emerald-500 transition-colors text-sm"
                                            placeholder="Masukkan nama Anda"
                                        />
                                    </div>
                                    <div className="bg-gray-700 bg-opacity-50 rounded-xl p-4 border border-gray-600">
                                        <p className="text-xs font-semibold text-emerald-400 mb-3">Target Nutrisi Harian</p>
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-gray-300 text-sm">Target Kalori</span>
                                            <span className="text-white font-semibold text-sm">{targetCalories} kkal</span>
                                        </div>
                                        <div className="flex justify-between items-center">
                                            <span className="text-gray-300 text-sm">Target Protein</span>
                                            <span className="text-white font-semibold text-sm">{targetProtein} g</span>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-2.5 mt-5">
                                    <button
                                        onClick={() => setShowModal(null)}
                                        className="flex-1 py-3 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium text-sm"
                                    >
                                        Batal
                                    </button>
                                    <button
                                        onClick={updateProfile}
                                        className="flex-1 py-3 rounded-xl bg-gradient-to-r from-emerald-600 to-cyan-600 hover:from-emerald-700 hover:to-cyan-700 transition-all duration-200 font-medium text-sm"
                                    >
                                        Simpan
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <CustomDialog
                        isOpen={showConfirmDialog === 'resetAll'}
                        onClose={() => setShowConfirmDialog(null)}
                        onConfirm={resetAllData}
                        title="Reset Semua Data?"
                        message="Semua log makanan hari ini akan dihapus. Tindakan ini tidak dapat dibatalkan."
                        type="danger"
                    />

                    {showConfirmDialog && showConfirmDialog !== 'resetAll' && (
                        <CustomDialog
                            isOpen={true}
                            onClose={() => setShowConfirmDialog(null)}
                            onConfirm={() => deleteEntry(showConfirmDialog)}
                            title="Hapus Log Makanan?"
                            message="Log makanan ini akan dihapus dari catatan harian Anda."
                            type="danger"
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CalorieTrackerApp />);
    </script>
    
    <style>
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</body>
</html>="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                                        Ambil dari Kamera
                                    </button>
                                    <button
                                        onClick={() => fileInputRef.current.click()}
                                        className="w-full py-3.5 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium flex items-center justify-center gap-2.5 text-sm"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                                        Upload dari Galeri
                                    </button>
                                    <button
                                        onClick={() => setShowModal('manual')}
                                        className="w-full py-3.5 rounded-xl bg-gray-700 hover:bg-gray-600 transition-all duration-200 font-medium flex items-center justify-center gap-2.5 text-sm"
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin